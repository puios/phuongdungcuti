<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Album pdungcutii</title>
<link href="https://fonts.googleapis.com/css2?family=Mali&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Mali', sans-serif;
    margin:0;
    padding:20px;
    text-align:center;
    background:#f4f4f4;
    transition: background 0.5s;
  }
  h1 { margin-bottom:20px; }
  .top-bar {
    position: fixed;
    top:0; left:0; right:0;
    display:flex; justify-content: space-between;
    padding:10px;
    z-index:1000;
  }
  .mode-btn, .ig-btn {
    font-size:3rem; cursor:pointer; user-select:none;
    display:flex; align-items:center; justify-content:center;
    width:3rem; height:3rem;
  }
  .mode-btn { margin-left:10px; }
  .ig-btn { margin-right:10px; }
  .gallery {
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:15px;
    max-width:800px;
    margin:60px auto 0 auto;
    transition: filter 0.3s;
  }
  .blur { filter: blur(5px); }
  .image-box {
    position: relative;
    width: 100%;
    padding-top: 100%;
    border-radius:12px;
    overflow:hidden;
    background:white;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
    cursor:pointer;
    transition: transform 0.2s;
  }
  .image-box:hover { transform: scale(1.03); }
  .image-box img {
    position:absolute;
    width:100%;
    height:100%;
    object-fit:cover;
    top:0; left:0;
  }
  .image-box p { display:none; }
  .lightbox {
    display:none;
    position:fixed; top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.85);
    justify-content:center; align-items:center;
    z-index:9999;
    flex-direction:column;
    color:white;
    opacity:0;
    transition: opacity 0.3s;
    overflow:hidden;
  }
  .lightbox.show { display:flex; opacity:1; }
  .lightbox img {
    max-width:90%;
    max-height:90%;
    border-radius:12px;
    box-shadow:0 0 30px rgba(255,255,255,0.5);
    margin-bottom:10px;
    transition: transform 1.3s ease, box-shadow 0.3s;
  }
  .lightbox p { margin:5px 0 0 0; font-size:16px; text-shadow:0 0 8px rgba(255,255,255,0.8); }
  .lightbox .close, .lightbox .prev, .lightbox .next {
    position:absolute;
    font-size:30px;
    cursor:pointer;
    user-select:none;
    background: rgba(0,0,0,0.3);
    padding:5px 10px;
    border-radius:6px;
  }
  .lightbox .close { top:20px; right:30px; }
  .lightbox .prev { left:20px; top:50%; transform: translateY(-50%); }
  .lightbox .next { right:20px; top:50%; transform: translateY(-50%); }
  @media(max-width:600px){ .gallery{grid-template-columns:1fr;} }
</style>
</head>
<body>
<div class="top-bar">
  <div class="mode-btn" id="modeBtn">🌙</div>
  <div class="ig-btn" id="igBtn">
    <img src="https://e7.pngegg.com/pngimages/672/312/png-clipart-instagram-logo-icon-others-text-photography.png" alt="Instagram" style="width:100%; height:100%;">
  </div>
</div>
<h1>Album pdungcutii📷</h1>
<div class="gallery" id="gallery"></div>
<div class="lightbox" id="lightbox">
  <span class="close" id="lb-close">&times;</span>
  <span class="prev" id="lb-prev">&#10094;</span>
  <span class="next" id="lb-next">&#10095;</span>
  <img id="lb-img" src="" alt="">
  <p id="lb-date"></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
<script>
const gallery=document.getElementById('gallery');
const lightbox=document.getElementById('lightbox');
const lbImg=document.getElementById('lb-img');
const lbDate=document.getElementById('lb-date');
const lbClose=document.getElementById('lb-close');
const lbPrev=document.getElementById('lb-prev');
const lbNext=document.getElementById('lb-next');
const modeBtn=document.getElementById('modeBtn');
const igBtn=document.getElementById('igBtn');

let imagesList=[],currentIndex=0,isAnimating=false,autoSlideTimer=null,isDark=false;

// Gallery
function displayImage(img){
  imagesList.push(img);
  const box=document.createElement('div');
  box.className='image-box';
  box.innerHTML=`<img src="images/${img.file}" alt="${img.file}">`;
  const index=imagesList.length-1;
  box.addEventListener('click',()=>openLightbox(index));
  gallery.appendChild(box);
}

// Lightbox
function openLightbox(index){
  currentIndex=index;
  isAnimating=true;
  lbImg.style.transform='scale(0.7)';
  lbImg.src=`images/${imagesList[index].file}`;
  lbDate.textContent=imagesList[index].date;
  lightbox.classList.add('show');
  document.body.style.overflow='hidden';
  setTimeout(()=>{ lbImg.style.transform='scale(1)'; isAnimating=false; },1300);
  startAutoSlide();
}

function closeLightbox(){
  lightbox.classList.remove('show');
  document.body.style.overflow='';
  lbImg.style.transform='scale(0.7)';
  setTimeout(()=>{ lbImg.src=''; lbDate.textContent=''; },1300);
  stopAutoSlide();
}

function updateLightbox(animate=false,direction=0){
  const img=imagesList[currentIndex];
  if(animate){
    lbImg.style.transition='transform 0.3s ease';
    lbImg.style.transform=`translateX(${direction*100}%)`;
    setTimeout(()=>{
      lbImg.src=`images/${img.file}`;
      lbDate.textContent=img.date;
      lbImg.style.transform=`translateX(${-direction*100}%)`;
      requestAnimationFrame(()=>{ lbImg.style.transform='translateX(0)'; });
    },300);
  }else{
    lbImg.src=`images/${img.file}`;
    lbDate.textContent=img.date;
    lbImg.style.transition='';
    lbImg.style.transform='translateX(0)';
  }
}

function prevImage(){
  if(isAnimating) return;
  currentIndex=(currentIndex-1+imagesList.length)%imagesList.length;
  updateLightbox(true,1);
}

function nextImage(){
  if(isAnimating) return;
  currentIndex=(currentIndex+1)%imagesList.length;
  updateLightbox(true,-1);
}

// Auto slide
function startAutoSlide(){
  if(autoSlideTimer) return;
  autoSlideTimer=setInterval(()=>{
    if(!isAnimating) nextImage();
  },3000);
}
function stopAutoSlide(){ clearInterval(autoSlideTimer); autoSlideTimer=null; }

// Events
lbClose.addEventListener('click',closeLightbox);
lbPrev.addEventListener('click',prevImage);
lbNext.addEventListener('click',nextImage);
lightbox.addEventListener('click',e=>{ if(e.target===lightbox) closeLightbox(); });

// Swipe support
let touchStartX=0,touchEndX=0;
lightbox.addEventListener('touchstart',e=>{ touchStartX=e.changedTouches[0].screenX; });
lightbox.addEventListener('touchend',e=>{ touchEndX=e.changedTouches[0].screenX; handleGesture(); });
function handleGesture(){
  const diff=touchEndX-touchStartX;
  if(diff<-50) nextImage();
  if(diff>50) prevImage();
}

// Dark/Light mode
modeBtn.addEventListener('click',()=>{
  isDark=!isDark;
  if(isDark){
    document.body.style.background='#111';
    modeBtn.textContent='☀️';
    lbImg.style.boxShadow='0 0 30px #fff';
    igBtn.firstElementChild.style.filter='invert(1)';
  }else{
    document.body.style.background='#f4f4f4';
    modeBtn.textContent='🌙';
    lbImg.style.boxShadow='0 0 30px rgba(255,255,255,0.5)';
    igBtn.firstElementChild.style.filter='invert(0)';
  }
});

// Instagram button
igBtn.addEventListener('click',()=>{ window.open('https://www.instagram.com/nquoi_dep/#','_blank'); });

// Load JSON
fetch('images/images.json')
  .then(res=>res.json())
  .then(data=>{ if(Array.isArray(data)) data.forEach(displayImage); })
  .catch(err=>console.warn('Không load được JSON:',err));

// Load YAML (tùy chọn)
fetch('images/update-images-json.yml')
  .then(res=>res.text())
  .then(text=>{
    const data=jsyaml.load(text);
    if(data && Array.isArray(data.images)) data.images.forEach(displayImage);
  })
  .catch(err=>console.warn('Không load được YAML:',err));
</script>
</body>
</html>
