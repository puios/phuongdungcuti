<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Album pdungcutii</title>
<link href="https://fonts.googleapis.com/css2?family=Mali&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Mali', sans-serif;
    margin:0;
    padding:20px;
    text-align:center;
    background:#f4f4f4;
    transition: background 0.5s;
  }
  h1 { margin-bottom:20px; }
  .top-bar {
    position: fixed;
    top:0; left:0; right:0;
    display:flex; justify-content: space-between;
    padding:10px;
    z-index:1000;
  }
  .mode-btn, .ig-btn {
    font-size:3rem; cursor:pointer; user-select:none;
    display:flex; align-items:center; justify-content:center;
    width:3rem; height:3rem;
  }
  .mode-btn { margin-left:10px; }
  .ig-btn { margin-right:10px; }
  .gallery {
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:15px;
    max-width:800px;
    margin:60px auto 0 auto;
    transition: filter 0.3s;
  }
  .blur { filter: blur(5px); }
  .image-box {
    position: relative;
    width: 100%;
    padding-top: 100%;
    border-radius:12px;
    overflow:hidden;
    background:white;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
    cursor:pointer;
    transition: transform 0.2s;
  }
  .image-box:hover { transform: scale(1.03); }
  .image-box img {
    position:absolute;
    width:100%;
    height:100%;
    object-fit:cover;
    top:0; left:0;
  }
  .image-box p { display:none; }
  .lightbox {
    display:none;
    position:fixed; top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.85);
    justify-content:center; align-items:center;
    z-index:9999;
    flex-direction:column;
    color:white;
    opacity:0;
    transition: opacity 0.3s;
    overflow:hidden;
  }
  .lightbox.show { display:flex; opacity:1; }
  .lightbox img {
    max-width:90%;
    max-height:90%;
    border-radius:12px;
    box-shadow:0 0 30px rgba(255,255,255,0.5);
    margin-bottom:10px;
    transition: transform 1.3s ease, box-shadow 0.3s, opacity 0.3s;
  }
  .lightbox p { margin:5px 0 0 0; font-size:16px; text-shadow:0 0 8px rgba(255,255,255,0.8); }
  .lightbox .close, .lightbox .prev, .lightbox .next {
    position:absolute;
    font-size:30px;
    cursor:pointer;
    user-select:none;
    background: rgba(0,0,0,0.3);
    padding:5px 10px;
    border-radius:6px;
  }
  .lightbox .close { top:20px; right:30px; }
  .lightbox .prev { left:20px; top:50%; transform: translateY(-50%); }
  .lightbox .next { right:20px; top:50%; transform: translateY(-50%); }
  @media(max-width:600px){ .gallery{grid-template-columns:1fr;} }
</style>
</head>
<body>
<div class="top-bar">
  <div class="mode-btn" id="modeBtn">🌙</div>
  <div class="ig-btn" id="igBtn">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="100%" height="100%">
      <path fill="currentColor" d="M349.33 69.33H162.67C106.36 69.33 69.33 106.36 69.33 162.67v186.67c0 56.31 37.03 93.34 93.34 93.34h186.67c56.31 0 93.34-37.03 93.34-93.34V162.67c0-56.31-37.03-93.34-93.34-93.34zm62.67 280c0 34.49-28.18 62.67-62.67 62.67H162.67c-34.49 0-62.67-28.18-62.67-62.67V162.67c0-34.49 28.18-62.67 62.67-62.67h186.67c34.49 0 62.67 28.18 62.67 62.67v186.66z"/>
      <path fill="currentColor" d="M256 164a92 92 0 1 0 0 184 92 92 0 0 0 0-184zm0 152a60 60 0 1 1 0-120 60 60 0 0 1 0 120z"/>
      <circle cx="396.67" cy="115.33" r="17.33" fill="currentColor"/>
    </svg>
  </div>
</div>
<h1>Album pdungcutii📷</h1>
<div class="gallery" id="gallery"></div>
<div class="lightbox" id="lightbox">
  <span class="close" id="lb-close">&times;</span>
  <span class="prev" id="lb-prev">&#10094;</span>
  <span class="next" id="lb-next">&#10095;</span>
  <img id="lb-img" src="" alt="">
  <p id="lb-date"></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
<script>
const gallery=document.getElementById('gallery');
const lightbox=document.getElementById('lightbox');
const lbImg=document.getElementById('lb-img');
const lbDate=document.getElementById('lb-date');
const lbClose=document.getElementById('lb-close');
const lbPrev=document.getElementById('lb-prev');
const lbNext=document.getElementById('lb-next');
const modeBtn=document.getElementById('modeBtn');
const igBtn=document.getElementById('igBtn');

let imagesList=[],currentIndex=0,isAnimating=false,isDark=false;

// Gallery
function displayImage(img){
  imagesList.push(img);
  const box=document.createElement('div');
  box.className='image-box';
  box.innerHTML=`<img src="images/${img.file}" alt="${img.file}">`;
  const index=imagesList.length-1;
  box.addEventListener('click',()=>openLightbox(index));
  gallery.appendChild(box);
}

// Lightbox
function openLightbox(index){
  currentIndex=index;
  isAnimating=true;

  // Reset transform/transition
  lbImg.style.transition='none';
  lbImg.style.transform='scale(0.7)';
  lbImg.src=`images/${imagesList[index].file}`;
  lbDate.textContent=imagesList[index].date;

  lightbox.classList.add('show');
  document.body.style.overflow='hidden';

  // Cho phép transition mượt
  requestAnimationFrame(()=>{
    lbImg.style.transition='transform 1.3s ease';
    lbImg.style.transform='scale(1)';
  });

  setTimeout(()=>{ isAnimating=false; }, 1300);
}

function closeLightbox(){
  if(isAnimating) return;
  isAnimating=true;

  lbImg.style.transition='transform 1.3s ease';
  lbImg.style.transform='scale(0.7)';

  setTimeout(()=>{
    lightbox.classList.remove('show');
    document.body.style.overflow='';
    lbImg.src='';
    lbDate.textContent='';
    isAnimating=false;
  }, 1300);
}

function updateLightbox(animate=false,direction=0){
  if(isAnimating) return;
  isAnimating=true;
  const img=imagesList[currentIndex];
  if(animate){
    lbImg.style.transition='transform 0.3s ease, opacity 0.3s ease';
    lbImg.style.opacity=0;
    setTimeout(()=>{
      lbImg.src=`images/${img.file}`;
      lbDate.textContent=img.date;
      lbImg.style.opacity=1;
      lbImg.style.transform='translateX(0)';
      isAnimating=false;
    },300);
  }else{
    lbImg.src=`images/${img.file}`;
    lbDate.textContent=img.date;
    lbImg.style.transition='none';
    lbImg.style.opacity=1;
    lbImg.style.transform='translateX(0)';
    isAnimating=false;
  }
}

// Prev/Next
function prevImage(){ if(isAnimating) return; currentIndex=(currentIndex-1+imagesList.length)%imagesList.length; updateLightbox(true,1);}
function nextImage(){ if(isAnimating) return; currentIndex=(currentIndex+1)%imagesList.length; updateLightbox(true,-1);}

// Events
lbClose.addEventListener('click',closeLightbox);
lbPrev.addEventListener('click',prevImage);
lbNext.addEventListener('click',nextImage);
lightbox.addEventListener('click',e=>{ if(e.target===lightbox) closeLightbox(); });

// Swipe support
let touchStartX=0,touchEndX=0;
lightbox.addEventListener('touchstart',e=>{ touchStartX=e.changedTouches[0].screenX; });
lightbox.addEventListener('touchend',e=>{ touchEndX=e.changedTouches[0].screenX; handleGesture(); });
function handleGesture(){ const diff=touchEndX-touchStartX; if(diff<-50) nextImage(); if(diff>50) prevImage(); }

// Dark/Light mode
modeBtn.addEventListener('click',()=>{
  isDark=!isDark;
  if(isDark){
    document.body.style.background='#111';
    modeBtn.textContent='☀️';
    lbImg.style.boxShadow='0 0 30px #fff';
    igBtn.firstElementChild.style.color='white';
  }else{
    document.body.style.background='#f4f4f4';
    modeBtn.textContent='🌙';
    lbImg.style.boxShadow='0 0 30px rgba(255,255,255,0.5)';
    igBtn.firstElementChild.style.color='black';
  }
});

// Instagram button
igBtn.addEventListener('click',()=>{ window.open('https://www.instagram.com/nquoi_dep/#','_blank'); });

// Load JSON
fetch('images/images.json')
  .then(res=>res.json())
  .then(data=>{ if(Array.isArray(data)) data.forEach(displayImage); })
  .catch(err=>console.warn('Không load được JSON:',err));

// Load YAML (tùy chọn)
fetch('images/update-images-json.yml')
  .then(res=>res.text())
  .then(text=>{
    const data=jsyaml.load(text);
    if(data && Array.isArray(data.images)) data.images.forEach(displayImage);
  })
  .catch(err=>console.warn('Không load được YAML:',err));
</script>
</body>
</html>
